# VBA 採点支援

## 概要

学校の評価項目管理および採点基準設定を自動化するVBAシステムです。科目・観点・単元別の評価シートを生成し、自動計算や色分け表示などの機能を提供します。

## 主要機能

### 1. シート作成・管理機能
- **設定シート管理**: 評価項目、生徒氏名、その他設定の管理
- **科目シート自動生成**: 科目ごとの評価シートを動的に作成
- **採点基準シート作成**: 単元別・観点別の採点基準シートを自動生成

### 2. データ処理機能
- **入力チェック**: 未入力箇所の検出と黄色ハイライト表示
- **データフィルタリング**: 科目・観点での動的フィルタリング
- **重複削除**: Dictionary機能を使った重複データの除去
- **配列処理**: 1次元配列への変換と処理

### 3. 自動計算機能
- **観点合計**: 各観点の点数合計を自動計算
- **到達率計算**: 配点に対する達成率を自動算出
- **ABC評価**: 設定基準に基づく自動評価判定
- **XLOOKUP関数**: 採点基準との連携による動的配点取得

### 4. UI・表示機能
- **セル書式設定**: 罫線、色分け、フォント統一
- **動的レイアウト**: 列幅自動調整、行固定
- **ボタン配置**: 単元追加・数式修正ボタンの動的生成
- **縦書き表示**: 単元名の縦書き表示

## ファイル構成

### メインモジュール
- **ArraySort**: 2次元配列のソート機能
- **create**: シート作成のメイン処理
- **createSubject**: 科目別シート生成処理

### データ管理クラス
- **SettingData**: 設定データの一元管理クラス

### ユーティリティ関数
- **SetColorAndBorder**: 色・罫線設定
- **SetFormula**: 自動計算式設定
- **addBtnCreate**: ボタン生成
- **NoInputsChk**: 入力チェック

## 使用方法

### 1. 初期設定
```vba
' メイン処理の実行
Sub start()
    Call create
    Call allSheetA1
End Sub
```

### 2. シート作成
1. 「評価項目設定」シートに科目・観点・単元を入力
2. 「生徒氏名設定」シートに生徒情報を入力  
3. `start()` を実行してシート自動生成

### 3. 評価入力
- 生成された科目シートに点数を入力
- 観点合計・到達率・評価が自動計算される

## 技術仕様

### 必要な設定
- **Option Base 1**: 配列の添字を1から開始
- **Microsoft Scripting Runtime**: Dictionary使用のため

### 主要定数
```vba
Public Const SettingSheet As String = "評価項目設定"
Public Const StudentSheet As String = "生徒氏名設定"
Public Const UnitCriteria As String = "採点基準_単元別"
Public Const PointCtriteria As String = "採点基準_観点別"
```

### データ構造
- **2次元配列**: 評価データの管理
- **Dictionary**: 重複削除・検索処理
- **Range**: セル範囲の動的管理

## 注意事項

1. **Option Base 1必須**: ArraySort関数使用時
2. **フィルタ状態管理**: 処理前後でのフィルタ解除が必要
3. **メモリ管理**: 大量データ処理時のオブジェクト解放
4. **エラーハンドリング**: On Error Resume Nextでの例外処理

## カスタマイズ

### 新しい観点の追加
1. `SettingData`クラスの`PointKeys`配列を更新
2. `GoukeiAreaCreate`関数の項目数調整
3. `SetFormula`関数の計算式更新

### レイアウト変更
- `SetColorAndBorder`関数で色・罫線をカスタマイズ
- `setWidth`関数で列幅を調整
- `HeaderStartCell`定数で開始位置を変更

## トラブルシューティング

### よくある問題
1. **配列エラー**: Option Base 1の設定確認
2. **計算式エラー**: 採点基準シートの存在確認
3. **フィルタエラー**: 事前のフィルタ解除
4. **メモリエラー**: オブジェクトの適切な解放
